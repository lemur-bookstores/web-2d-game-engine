# v0.5.0 - Layers y Camera

## Resumen del objetivo

Implementar un sistema de capas (layers) y una cámara 2D (Camera2D) con viewport, zoom y seguimiento de entidades. Esto incluye cambios en runtime (Engine/Scene), sistemas (Render, Culling), y utilidades (Camera class), además de tests y ejemplos.

## Alcance y entregables

- Sistema de capas que permita asignar entidades y sistemas a capas, y filtrado por capas en render y colisiones.
- Camera2D con: viewport, position, zoom, rotation, follow(target, options), lerp smoothing, bounds/clamping, and shake effect.
- RenderSystem y WebGL/Canvas renderers adaptados para soportar camera transforms y layer-based rendering order.
- Culling optimizado por viewport y por layer, con opción de quadtree/grid (opcional inicialmente).
- API pública y types actualizados, documentación y ejemplos actualizados.
- Tests unitarios/integración para las funcionalidades clave.

## Requisitos detallados

1. Core / Scene / Engine

- Scene: soporte para definir y gestionar capas con nombre y máscara (bit).
- Engine: método para obtener máscara de capas activas y orden de render por capa.
- Default layers en Engine (background, default, foreground, ui).

2. Componentes/Entities

- Permitir asignar `layer` a entidades (por nombre o bit).
- Serialización/Deserialización de layer en escenas.

3. Camera2D

- Clase `Camera2D` con propiedades: position: Vector2, zoom: number, rotation: number, viewport: Rect
- Métodos: worldToScreen(point), screenToWorld(point), follow(entity|position, options), setBounds(rect), shake(intensity, duration), update(delta)
- Options for follow: { lerp: number, offset: Vector2 }
- Camera smoothing with configurable lerp factor
- Clamp camera to bounds if provided

4. RenderSystem / Renderer

- Apply camera transform (translate/scale/rotate) before drawing entities
- Respect entity layer ordering; render by layer order
- Renderer API: accept camera transform and clip to viewport
- Implement layer opacity and visibility flags

5. Culling & Optimization

- Implement viewport culling (loose-frustum) by default
- Add optional Quadtree module later; design API for easy swap
- Provide enable/disable flags for culling per-system

6. API / Types / Docs / Examples

- Export `Camera2D` in `src/index.ts` public API
- Update README and docs with usage examples
- Create `examples/layers-camera/` demo showing layers, camera follow, zoom, and culling.

7. Tests

- Unit tests for Camera transforms, follow smoothing, bounds clamping
- Integration tests for render order by layers and culling
- Smoke test for example demo build

## Plan de trabajo y milestones

- M1: Layer system in `Scene` + engine defaults + entity layer assignment
- M2: Camera2D core implementation + unit tests
- M3: RenderSystem changes to use camera + layer order + culling basic
- M4: Example demo and docs + integration tests

## Criterios de aceptación

- All unit tests pass locally
- Example demo runs and visually shows layers + camera features
- Public API updated and documented
- PR created from `feature/v0.5.0-layers-camera` into `develop` with clear description

## Tareas (issues) sugeridas

- feat(scene): add layers support
- feat(engine): default layers and layer mask utilities
- feat(entity): add layer property to Entity
- feat(camera): implement Camera2D class
- feat(render): apply camera transforms and layer ordering
- feat(culling): implement viewport culling
- test(camera): unit tests for Camera2D
- test(render): integration tests for layer ordering
- docs: add v0.5.0 roadmap and usage examples

## Notas

- Mantener compatibilidad hacia atrás: si una escena no define capas, usar defaults del Engine.
- Mantener performance: culling por defecto para evitar renderear todo.
- Diseño extensible: permitir futuras opciones (quadtree, multiple cameras, split-screen)
