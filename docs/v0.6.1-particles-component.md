# v0.6.1 - Particles Component & Particle System

Resumen

- Añade soporte para sistemas de partículas: componentes serializables, sistema de actualización y metadata para editor.
- Basado en el diseño del sistema de luces (registro, mappers, culling por cámara y layer masks) pero optimizado para muchos emisores y partículas ligeras.

Motivación

- Permitir efectos visuales dinámicos (explosiones, humo, fuego, chispas) con bajo coste en rendimiento.
- Facilitar edición en runtime con inspector y serialización de emisores.

Conceptos clave

- ParticleComponent: datos serializables del emisor (rate, lifetime, speed, spread, color).
- ParticleSystem: sistema ECS que actualiza partículas, maneja spawn y culling.
- Registry: (plan) exponer metadata y mappers para el inspector, similar a LightRegistry.

API y diseño (inicial)

- `ParticleComponent` (POJO) y `createDefaultParticleComponent()`.
- `ParticleSystem` (subclase de `System`) con métodos básicos:
  - `update(entities, dt)` — actualiza partículas y emisores.
  - `attachEmitter(entity, component)` — vincula un emisor a una entidad.
- Culling y capas: las partículas respetarán `layer` y `layerMask` en el emitter; se podrá añadir resolución de layerName -> bitmask via `Scene` y resolver similar a `LightRegistry.setLayerResolver`.

Estrategia de implementación completa (pasos siguientes)

1. Implementar `ParticleRegistry` con metadata y `normalizeLayerTarget` reutilizable.
2. Integrar `ParticleSystem.setScene(scene)` para registrar el resolver de layers y permitir culling por cámara.
3. Implementar un pool de partículas (reuso de instancias) y estrategias de batching para renderers (WebGL/Canvas2D).
4. Añadir mappers/metadata para inspector (color, vector, sprite, blend mode).
5. Tests unitarios: spawn, lifetime, emission rate, culling, serialization roundtrip.

Notas de rendimiento

- Priorizar pools y evitar new/delete por frame.
- Agrupar partículas por material/blend mode para minimizar draw calls.

Ejemplo mínimo

```ts
const ps = new ParticleSystem();
const emitter = createDefaultParticleComponent();
ps.attachEmitter(someEntity, emitter);
// agregar ps al engine/world
```

Este documento es la especificación inicial; puedo proceder a implementar las etapas 1-4 y añadir tests y docs de ejemplo si confirmas.
